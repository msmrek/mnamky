!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports&&"function"==typeof require?factory(require("jquery")):factory(jQuery)}(function($){"use strict";function Autocomplete(el,options){var noop=$.noop,defaults={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,onMouseOver:null,onMouseLeave:null,width:"100%",minChars:1,maxHeight:1e3,deferRequestBy:0,params:{},delimiter:null,zIndex:9999,type:"GET",noCache:!1,is_rtl:!1,onSearchStart:noop,onSearchComplete:noop,onSearchError:noop,preserveInput:!1,wrapperaClass:"search-wrapp",containerClass:"search-suggestions-wrapp",preloaderClass:"search-preloader",closeTrigger:"search-close",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(suggestion,originalQuery,queryLowerCase){return-1!==suggestion.value.toLowerCase().indexOf(queryLowerCase)},paramName:"query",transformResult:function(response){return"string"==typeof response?JSON.parse(response):response},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom"};this.element=el,this.el=$(el),this.suggestions=[],this.badQueries=[],this.selectedIndex=-1,this.currentValue=this.element.value,this.intervalId=0,this.cachedResponse={},this.detailsRequestsSent=[],this.onChangeInterval=null,this.onChange=null,this.isLocal=!1,this.suggestionsContainer=null,this.detailsContainer=null,this.noSuggestionsContainer=null,this.options=$.extend({},defaults,options),this.classes={selected:"search-suggestion-selected",suggestion:"search-suggestion"},this.hint=null,this.hintValue="",this.selection=null,this.initialize(),this.setOptions(options)}var utils={escapeRegExChars:function(value){return value.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(containerClass){var div=document.createElement("div");return div.className=containerClass,div.style.display="none",div}},keys_ESC=27,keys_TAB=9,keys_RETURN=13,keys_UP=38,keys_RIGHT=39,keys_DOWN=40;Autocomplete.utils=utils,($.Autocomplete=Autocomplete).prototype={killerFn:null,initialize:function(){var container,that=this,suggestionSelector="."+that.classes.suggestion,options=(that.classes.selected,that.options),closeTrigger="."+options.closeTrigger;that.killerFn=function(e){0===$(e.target).closest("."+that.options.containerClass).length&&(that.killSuggestions(),that.disableKillerFn())},that.suggestionsContainer=Autocomplete.utils.createNode(options.containerClass),(container=$(that.suggestionsContainer)).appendTo(that.el.closest("."+options.wrapperaClass)),"auto"!==options.width&&container.width(options.width),container.on("mouseover.autocomplete",suggestionSelector,function(){that.onMouseOver($(this).data("index")),that.activate($(this).data("index"))}),container.on("mouseout.autocomplete",function(){}),$(document).on("click.autocomplete",closeTrigger,function(e){that.killerFn(e),that.clear(e),$(this).removeClass(options.closeTrigger),that.el.val("").focus()}),container.on("click.autocomplete",suggestionSelector,function(){return that.select($(this).data("index")),!1}),that.el.on("keydown.autocomplete",function(e){that.onKeyPress(e)}),that.el.on("keyup.autocomplete",function(e){that.onKeyUp(e)}),that.el.on("change.autocomplete",function(e){that.onKeyUp(e)}),that.el.on("input.autocomplete",function(e){that.onKeyUp(e)})},onFocus:function(){this.el.val().length>=this.options.minChars&&this.onValueChange()},onBlur:function(){this.enableKillerFn()},abortAjax:function(){this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null)},setOptions:function(suppliedOptions){var that=this,options=that.options;$.extend(options,suppliedOptions),that.isLocal=Array.isArray(options.lookup),that.isLocal&&(options.lookup=that.verifySuggestionsFormat(options.lookup)),options.orientation=that.validateOrientation(options.orientation,"bottom"),that.options.onSearchComplete=function(){that.preloader("hide",$("."+options.preloaderClass),options.closeTrigger)}},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){this.disabled=!0,clearInterval(this.onChangeInterval),this.abortAjax()},enable:function(){this.disabled=!1},enableKillerFn:function(){$(document).on("click.autocomplete",this.killerFn)},disableKillerFn:function(){$(document).off("click.autocomplete",this.killerFn)},killSuggestions:function(){var that=this;$(that.suggestionsContainer).parent();that.stopKillSuggestions(),that.intervalId=window.setInterval(function(){that.visible&&(that.options.preserveInput||that.el.val(that.currentValue),that.hide()),that.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var range,valLength=this.el.val().length,selectionStart=this.element.selectionStart;return"number"==typeof selectionStart?selectionStart===valLength:!document.selection||((range=document.selection.createRange()).moveStart("character",-valLength),valLength===range.text.length)},onKeyPress:function(e){if(this.disabled||this.visible||e.which!==keys_DOWN||!this.currentValue){if(!this.disabled&&this.visible){switch(e.which){case keys_ESC:this.el.val(this.currentValue),this.hide();break;case keys_RIGHT:if(this.hint&&this.options.onHint&&this.isCursorAtEnd()){this.selectHint();break}return;case keys_TAB:if(this.hint&&this.options.onHint)return void this.selectHint();if(-1===this.selectedIndex)return void this.hide();if(this.select(this.selectedIndex),!1===this.options.tabDisabled)return;break;case keys_RETURN:if(-1===this.selectedIndex)return void this.hide();this.select(this.selectedIndex);break;case keys_UP:this.moveUp();break;case keys_DOWN:this.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}}else this.suggest()},onKeyUp:function(e){var that=this;if(!that.disabled){switch(e.which){case keys_UP:case keys_DOWN:return}clearInterval(that.onChangeInterval),that.currentValue!==that.el.val()&&(that.findBestHint(),0<that.options.deferRequestBy?that.onChangeInterval=setInterval(function(){that.onValueChange()},that.options.deferRequestBy):that.onValueChange())}},onValueChange:function(){var options=this.options,value=this.el.val(),query=this.getQuery(value);this.selection&&this.currentValue!==query&&(this.selection=null,(options.onInvalidateSelection||$.noop).call(this.element)),clearInterval(this.onChangeInterval),this.currentValue=value,this.selectedIndex=-1,options.triggerSelectOnValidInput&&this.isExactMatch(query)?this.select(0):query.length<options.minChars?($("."+this.options.closeTrigger).removeClass(this.options.closeTrigger),this.hide()):this.getSuggestions(query)},isExactMatch:function(query){var suggestions=this.suggestions;return 1===suggestions.length&&suggestions[0].value.toLowerCase()===query.toLowerCase()},getQuery:function(value){var parts,delimiter=this.options.delimiter;return delimiter?(parts=value.split(delimiter),$.trim(parts[parts.length-1])):value},getSuggestionsLocal:function(query){var data,options=this.options,queryLowerCase=query.toLowerCase(),filter=options.lookupFilter,limit=parseInt(options.lookupLimit,10);return data={suggestions:$.grep(options.lookup,function(suggestion){return filter(suggestion,query,queryLowerCase)})},limit&&data.suggestions.length>limit&&(data.suggestions=data.suggestions.slice(0,limit)),data},getSuggestions:function(q){var response,params,cacheKey,ajaxSettings,that=this,container=$(that.suggestionsContainer),options=that.options,serviceUrl=options.serviceUrl;options.params[options.paramName]=q,params=options.ignoreParams?null:options.params,that.preloader("show",$("."+options.preloaderClass),"search-inner-preloader",container),!1!==options.onSearchStart.call(that.element,options.params)&&($.isFunction(options.lookup)?options.lookup(q,function(data){that.suggestions=data.suggestions,that.suggest(),options.onSearchComplete.call(that.element,q,data.suggestions)}):(that.isLocal?response=that.getSuggestionsLocal(q):($.isFunction(serviceUrl)&&(serviceUrl=serviceUrl.call(that.element,q)),cacheKey=serviceUrl+"?"+$.param(params||{}),response=that.cachedResponse[cacheKey]),response&&Array.isArray(response.suggestions)?(that.suggestions=response.suggestions,that.suggest(),options.onSearchComplete.call(that.element,q,response.suggestions)):that.isBadQuery(q)?options.onSearchComplete.call(that.element,q,[]):(that.abortAjax(),ajaxSettings={url:serviceUrl,data:params,type:options.type,dataType:options.dataType},$.extend(ajaxSettings,options.ajaxSettings),that.currentRequest=$.ajax(ajaxSettings).done(function(data){var result;that.currentRequest=null,void 0!==(result=options.transformResult(data,q)).suggestions&&that.processResponse(result,q,cacheKey),options.onSearchComplete.call(that.element,q,result.suggestions)}).fail(function(jqXHR,textStatus,errorThrown){options.onSearchError.call(that.element,q,jqXHR,textStatus,errorThrown)}))))},isBadQuery:function(q){if(!this.options.preventBadQueries)return!1;for(var badQueries=this.badQueries,i=badQueries.length;i--;)if(0===q.indexOf(badQueries[i]))return!0;return!1},hide:function(){var container=$(this.suggestionsContainer),containerParent=$(this.suggestionsContainer).parent();$.isFunction(this.options.onHide)&&this.visible&&this.options.onHide.call(this.element,container),this.visible=!1,this.selectedIndex=-1,clearInterval(this.onChangeInterval),$(this.suggestionsContainer).hide(),$(this.detailsContainer).hide(),containerParent.removeClass("search-open"),this.signalHint(null)},suggest:function(){if(""!=this.suggestions){var options=this.options,value=(options.groupBy,options.formatResult,this.getQuery(this.currentValue)),className=this.classes.suggestion,classSelected=this.classes.selected,container=$(this.suggestionsContainer),noSuggestionsContainer=$(this.noSuggestionsContainer),beforeRender=options.beforeRender;options.triggerSelectOnValidInput&&this.isExactMatch(value)?this.select(0):(this.adjustContainerWidth(),noSuggestionsContainer.detach(),container.html(this.suggestions),$.isFunction(beforeRender)&&beforeRender.call(this.element,container,this.suggestions),container.show(),container.parent().addClass("search-open"),options.autoSelectFirst&&(this.selectedIndex=0,container.scrollTop(0),container.children("."+className).first().addClass(classSelected)),this.visible=!0,this.findBestHint())}else this.options.showNoSuggestionNotice?this.noSuggestions():this.hide()},noSuggestions:function(){},adjustContainerWidth:function(){var width,options=this.options,containerSugg=($(this.suggestionsContainer).parent(),$(this.suggestionsContainer));"auto"===options.width&&(width=this.el.outerWidth(),containerSugg.css("width",width+"px"))},findBestHint:function(){this.el.val().toLowerCase()&&this.signalHint(null)},signalHint:function(suggestion){var hintValue="";suggestion&&(hintValue=this.currentValue+suggestion.value.substr(this.currentValue.length)),this.hintValue!==hintValue&&(this.hintValue=hintValue,this.hint=suggestion,(this.options.onHint||$.noop)(hintValue))},preloader:function(action,container,cssClass,suggestionsContainer){var cssClasses=null==cssClass?"search-preloader-wrapp":"search-preloader-wrapp "+cssClass;1==search.show_preloader&&0!=container.length&&("hide"===action&&($("search-preloader-wrapp").remove(),container.html(""),$(".search-suggestions-wrapp .products")[0]),"show"===action&&(suggestionsContainer.html(""),container.html('<div class="'+cssClasses+'"></div>')))},validateOrientation:function(orientation,fallback){return orientation=$.trim(orientation||"").toLowerCase(),-1===$.inArray(orientation,["auto","bottom","top"])&&(orientation=fallback),orientation},processResponse:function(result,originalQuery,cacheKey){var options=this.options;options.noCache||(this.cachedResponse[cacheKey]=result,options.preventBadQueries&&!result.suggestions.length&&this.badQueries.push(originalQuery)),originalQuery===this.getQuery(this.currentValue)&&(this.suggestions=result.suggestions,this.suggest())},activate:function(index){var activeItem,selected=this.classes.selected,container=$(this.suggestionsContainer),children=container.find("."+this.classes.suggestion);return container.find("."+selected).removeClass(selected),this.selectedIndex=index,-1!==this.selectedIndex&&children.length>this.selectedIndex?(activeItem=children.get(this.selectedIndex),$(activeItem).addClass(selected),activeItem):null},selectHint:function(){var i=$.inArray(this.hint,this.suggestions);this.select(i)},select:function(i){this.hide(),this.onSelect(i),this.disableKillerFn()},moveUp:function(){if(-1!==this.selectedIndex)return 0===this.selectedIndex?($(this.suggestionsContainer).children().first().removeClass(this.classes.selected),this.selectedIndex=-1,this.el.val(this.currentValue),void this.findBestHint()):void this.adjustScroll(this.selectedIndex-1)},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(index){var activeItem=this.activate(index);if(activeItem){var offsetTop,upperBound,lowerBound,heightDelta=$(activeItem).outerHeight();offsetTop=activeItem.offsetTop,lowerBound=(upperBound=$(this.suggestionsContainer).scrollTop())+this.options.maxHeight-heightDelta,offsetTop<upperBound?$(this.suggestionsContainer).scrollTop(offsetTop):lowerBound<offsetTop&&$(this.suggestionsContainer).scrollTop(offsetTop-this.options.maxHeight+heightDelta),this.options.preserveInput||this.el.val(this.getValue(this.suggestions[index].value)),this.signalHint(null)}},onSelect:function(index){var onSelectCallback=this.options.onSelect,suggestion=this.suggestions[index];this.currentValue=this.getValue(suggestion.value),this.currentValue===this.el.val()||this.options.preserveInput||this.el.val(this.currentValue),-1!=suggestion.id&&(window.location.href=suggestion.url),this.signalHint(null),this.suggestions=[],this.selection=suggestion,$.isFunction(onSelectCallback)&&onSelectCallback.call(this.element,suggestion)},onMouseOver:function(index){var onMouseOverCallback=this.options.onMouseOver,suggestion=this.suggestions[index];$.isFunction(onMouseOverCallback)&&onMouseOverCallback.call(this.element,suggestion)},onMouseLeave:function(index){var onMouseLeaveCallback=this.options.onMouseLeave,suggestion=this.suggestions[index];$.isFunction(onMouseLeaveCallback)&&onMouseLeaveCallback.call(this.element,suggestion)},getValue:function(value){var currentValue,parts,delimiter=this.options.delimiter;return delimiter?1===(parts=(currentValue=this.currentValue).split(delimiter)).length?value:currentValue.substr(0,currentValue.length-parts[parts.length-1].length)+value:value},dispose:function(){this.el.off(".autocomplete").removeData("autocomplete"),this.disableKillerFn(),$(this.suggestionsContainer).remove()}},$.fn.dgwtWcasAutocomplete=function(options,args){return arguments.length?this.each(function(){var inputElement=$(this),instance=inputElement.data("autocomplete");"string"==typeof options?instance&&"function"==typeof instance[options]&&instance[options](args):(instance&&instance.dispose&&instance.dispose(),instance=new Autocomplete(this,options),inputElement.data("autocomplete",instance))}):this.first().data("autocomplete")},$(function(){$(".search-input").dgwtWcasAutocomplete({minChars:3,autoSelectFirst:!1,triggerSelectOnValidInput:!1,serviceUrl:search.ajax_search_endpoint,paramName:"search_keyword"})})});