"use strict";!function(e,t,a,s){var u=window.wp.element.createElement,r=e.blocks.registerBlockType,o=e.components,i=(o.TextControl,o.SelectControl),n=(o.RadioControl,o.ToggleControl),_=o.RangeControl,l=o.SVG,d=o.Path,c=e.blockEditor.InspectorControls,b=e.apiFetch;r("getbowtied/sk-posts-grid",{title:a.__("Posts Grid","shopkeeper-extender"),icon:u(l,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},u(d,{d:"M4 5v13h17V5H4zm10 2v3.5h-3V7h3zM6 7h3v3.5H6V7zm0 9v-3.5h3V16H6zm5 0v-3.5h3V16h-3zm8 0h-3v-3.5h3V16zm-3-5.5V7h3v3.5h-3z"})),category:"shopkeeper",supports:{align:["center","wide","full"]},attributes:{queryPosts:{type:"string",default:""},queryPostsLast:{type:"string",default:""},isLoading:{type:"bool",default:!1},categoriesIDs:{type:"string",default:","},categoriesSavedIDs:{type:"string",default:""},firstLoad:{type:"boolean",default:!0},number:{type:"number",default:"12"},columns:{type:"number",default:"3"},orderby:{type:"string",default:"date_desc"},excerpt:{type:"boolean",default:!1}},edit:function(d){function g(e,t,s){var r="/wp/v2/posts?per_page="+t;switch(","==e.substr(0,1)&&(e=e.substr(1)),","==e.substr(e.length-1)&&(e=e.substring(0,e.length-1)),","!=e&&""!=e&&(r="/wp/v2/posts?categories="+e+"&per_page="+t),s){case"date_asc":r+="&orderby=date&order=asc";break;case"date_desc":r+="&orderby=date&order=desc";break;case"title_asc":r+="&orderby=title&order=asc";break;case"title_desc":r+="&orderby=title&order=desc"}return r+="&lang="+posts_grid_vars.language}function t(){var e=p.queryPosts;d.setAttributes({queryPostsLast:e}),""!=e&&b({path:e}).then(function(e){d.setAttributes({result:e}),d.setAttributes({isLoading:!1}),d.setAttributes({doneFirstPostsLoad:!0})})}var s,r,o,p=d.attributes;return p.doneFirstLoad=p.doneFirstLoad||!1,p.categoryOptions=p.categoryOptions||[],p.doneFirstPostsLoad=p.doneFirstPostsLoad||!1,p.result=p.result||[],[u(c,{key:"sk-posts-grid-inspector"},u("div",{className:"main-inspector-wrapper"},u("label",{className:"components-base-control__label"},a.__("Categories:","shopkeeper-extender")),u("div",{className:"category-result-wrapper"},p.categoryOptions.length<1&&!1===p.doneFirstLoad&&(s=[],r=[],o=[],void b({path:"/wp/v2/categories?per_page=-1&lang="+posts_grid_vars.language}).then(function(e){for(var t=0;t<e.length;t++)s[t]={label:e[t].name.replace(/&amp;/g,"&"),value:e[t].id,parent:e[t].parent,count:e[t].count},r[t]=e[t].id.toString();o=function e(t,s){for(var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=0;a<s.length;a++)s[a].parent==t&&(s[a].level=o,r.push(s[a]),e(s[a].value,s,r,o+1));return r}(0,s),d.setAttributes({categoryOptions:o}),function(e){var t=p.categoriesIDs,s=p.categoriesIDs;if(","==t.substr(0,1)&&(t=t.substr(1)),","==t.substr(t.length-1)&&(t=t.substring(0,t.length-1)),","!=t&&""!=t)for(var r=t.split(","),o=0;o<r.length;o++)-1==e.indexOf(r[o])&&(s=s.replace(","+r[o].toString()+",",","));p.categoriesIDs!=s&&(d.setAttributes({queryPosts:g(s,p.number,p.orderby)}),d.setAttributes({queryPostsLast:g(s,p.number,p.orderby)})),d.setAttributes({categoriesIDs:s}),d.setAttributes({categoriesSavedIDs:s})}(r),d.setAttributes({doneFirstLoad:!0})})),function e(){var t,s,r,o,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=[],_=p.categoryOptions;if(0<_.length)for(var l=0;l<_.length;l++)_[l].parent==a&&n.push(u("li",{key:"category_li__"+l,className:"level-"+_[l].level},u("label",{key:"category_label_"+l,className:(r=_[l].parent,o=_[l].value,(0==r?"parent parent-"+o:"child child-"+r)+" "+_[l].level)},u("input",{type:"checkbox",key:"category-checkbox-"+_[l].value,value:_[l].value,"data-index":l,"data-parent":_[l].parent,checked:(t=","+_[l].value+",",s=p.categoriesIDs,-1<s.indexOf(t.toString())),onChange:function(e){var t=p.categoriesIDs,s=t.indexOf(","+e.target.value+",");!0===e.target.checked?-1==s&&(t+=e.target.value+","):-1<s&&(t=t.replace(","+e.target.value+",",",")),d.setAttributes({categoriesIDs:t}),d.setAttributes({queryPosts:g(t,p.number,p.orderby)})}}),_[l].label,u("sup",{},_[l].count)),e(_[l].value,i+1)));return 0<n.length?u("ul",{className:"level-"+i},n):void 0}()),u(i,{key:"sk-posts-grid-order-by",options:[{value:"title_asc",label:a.__("Alphabetical Ascending","shopkeeper-extender")},{value:"title_desc",label:a.__("Alphabetical Descending","shopkeeper-extender")},{value:"date_asc",label:a.__("Date Ascending","shopkeeper-extender")},{value:"date_desc",label:a.__("Date Descending","shopkeeper-extender")}],label:a.__("Order By","shopkeeper-extender"),value:p.orderby,onChange:function(e){d.setAttributes({orderby:e});var t=p.categoriesIDs;d.setAttributes({queryPosts:g(t,p.number,e)})}}),u(_,{key:"sk-posts-grid-number",className:"range-wrapper",value:p.number,allowReset:!1,initialPosition:12,min:1,max:20,label:a.__("Number of Posts","shopkeeper-extender"),onChange:function(e){d.setAttributes({number:e});var t=p.categoriesIDs;d.setAttributes({queryPosts:g(t,e,p.orderby)})}}),u("button",{className:"render-results components-button is-button is-default is-primary is-large "+(!0===p.isLoading?"is-busy":""),disabled:0==p.queryPosts.length||p.queryPosts===p.queryPostsLast,onClick:function(e){d.setAttributes({isLoading:!0}),d.setAttributes({categoriesSavedIDs:p.categoriesIDs}),t()}},!1===p.isLoading?a.__("Update","shopkeeper-extender"):a.__("Updating","shopkeeper-extender")),u("hr",{}),u(_,{key:"sk-posts-grid-columns",value:p.columns,allowReset:!1,initialPosition:3,min:1,max:4,label:a.__("Columns","shopkeeper-extender"),onChange:function(e){d.setAttributes({columns:e})}}),u(n,{key:"sk-posts-grid-excerpts",label:a.__("Post Excerpts","shopkeeper-extender"),checked:p.excerpt,onChange:function(){d.setAttributes({excerpt:!p.excerpt})}}))),u("div",{key:"gbt_18_sk_posts_grid",className:"gbt_18_sk_posts_grid"},u("div",{key:"gbt_18_sk_editor_posts_grid_wrapper",className:"gbt_18_sk_editor_posts_grid_wrapper columns-"+p.columns},p.result.length<1&&!1===p.doneFirstPostsLoad&&t(),function(){!0===p.firstLoad&&b({path:"/wp/v2/posts?per_page=12&orderby=date&order=desc&lang="+posts_grid_vars.language}).then(function(e){d.setAttributes({result:e}),d.setAttributes({firstLoad:!1});var t="/wp/v2/posts?per_page=12&orderby=date&order=desc&lang="+posts_grid_vars.language;d.setAttributes({queryPosts:t}),d.setAttributes({queryPostsLast:t})});var e=p.result,t=[];if(0<e.length)for(var s=0;s<e.length;s++){var r="",o="gbt_18_sk_editor_posts_grid_noimg";e[s].fimg_url?(r=e[s].fimg_url,o="gbt_18_sk_editor_posts_grid_with_img"):(o="gbt_18_sk_editor_posts_grid_noimg",r=""),t.push(u("div",{key:"gbt_18_sk_editor_posts_grid_item_"+e[s].id,className:"gbt_18_sk_editor_posts_grid_item"},u("a",{key:"gbt_18_sk_editor_posts_grid_item_link_"+s,className:"gbt_18_sk_editor_posts_grid_item_link"},u("span",{key:"gbt_18_sk_editor_posts_grid_img_container_"+s,className:"gbt_18_sk_editor_posts_grid_img_container"},u("span",{key:"gbt_18_sk_editor_posts_grid_img_overlay_"+s,className:"gbt_18_sk_editor_posts_grid_img_overlay"}),u("span",{key:"gbt_18_sk_editor_posts_grid_img_"+s,className:"gbt_18_sk_editor_posts_grid_img "+o,style:{backgroundImage:"url("+r+")"}})),u("span",{key:"gbt_18_sk_editor_posts_grid_title_"+s,className:"gbt_18_sk_posts_grid_title",dangerouslySetInnerHTML:{__html:e[s].title.rendered}}),p.excerpt&&u("p",{key:"gbt_18_sk_editor_posts_grid_excerpt_"+s,className:"gbt_18_sk_posts_grid_excerpt",dangerouslySetInnerHTML:{__html:e[s].excerpt.rendered.substr(0,100)+"..."}}),p.excerpt&&u("span",{key:"gbt_18_sk_editor_posts_grid_more_"+s,className:"gbt_18_sk_posts_grid_more_link"},a.__("Continue Reading","shopkeeper-extender")))))}return t}()))]},save:function(e){return null}})}(window.wp,window.wp.blocks,window.wp.i18n);